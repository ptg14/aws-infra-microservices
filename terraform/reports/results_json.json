{"check_type": "terraform", "results": {"passed_checks": [{"check_id": "CKV_AWS_41", "bc_check_id": "BC_AWS_SECRETS_5", "check_name": "Ensure no hard coded AWS access key and secret key exists in provider", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[19, "provider \"aws\" {\n"], [20, "  region = var.region\n"], [21, "\n"], [22, "  default_tags {\n"], [23, "    tags = {\n"], [24, "      Project     = var.project\n"], [25, "      Environment = var.environment\n"], [26, "      ManagedBy   = \"Terraform\"\n"], [27, "    }\n"], [28, "  }\n"], [29, "}\n"]], "file_path": "/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "repo_file_path": "/main.tf", "file_line_range": [19, 29], "resource": "aws.default", "evaluations": null, "check_class": "checkov.terraform.checks.provider.aws.credentials", "fixed_definition": null, "entity_tags": null, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/secrets-policies/bc-aws-secrets-5", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "breadcrumbs": {"region": [{"type": "tfvar", "name": "region", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/terraform.tfvars", "module_connection": false}, {"type": "variable", "name": "region", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/variables.tf", "module_connection": false}], "default_tags.tags.Project": [{"type": "tfvar", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/terraform.tfvars", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/variables.tf", "module_connection": false}], "default_tags.tags": [{"type": "tfvar", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/terraform.tfvars", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/variables.tf", "module_connection": false}], "default_tags.tags.Environment": [{"type": "tfvar", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/terraform.tfvars", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/variables.tf", "module_connection": false}]}}, {"check_id": "CKV_AWS_23", "bc_check_id": "BC_AWS_NETWORKING_31", "check_name": "Ensure every security group and rule has a description", "check_result": {"result": "PASSED", "evaluated_keys": ["description"]}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupRuleDescription", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-31", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_382", "bc_check_id": "BC_AWS_IAM_93", "check_name": "Ensure no security groups allow egress from 0.0.0.0:0 to port -1", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedEgressAny", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/bc-aws-382", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_25", "bc_check_id": "BC_AWS_NETWORKING_2", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port 3389", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngress3389", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-2", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_24", "bc_check_id": "BC_AWS_NETWORKING_1", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port 22", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngress22", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-1-port-security", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_277", "bc_check_id": "BC_AWS_NETWORKING_78", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port -1", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngressAny", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-security-group-does-not-allow-all-traffic-on-all-ports", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_23", "bc_check_id": "BC_AWS_NETWORKING_31", "check_name": "Ensure every security group and rule has a description", "check_result": {"result": "PASSED", "evaluated_keys": ["description"]}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupRuleDescription", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-31", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_382", "bc_check_id": "BC_AWS_IAM_93", "check_name": "Ensure no security groups allow egress from 0.0.0.0:0 to port -1", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedEgressAny", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/bc-aws-382", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_25", "bc_check_id": "BC_AWS_NETWORKING_2", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port 3389", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngress3389", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-2", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_24", "bc_check_id": "BC_AWS_NETWORKING_1", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port 22", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngress22", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-1-port-security", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_277", "bc_check_id": "BC_AWS_NETWORKING_78", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port -1", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngressAny", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-security-group-does-not-allow-all-traffic-on-all-ports", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_260", "bc_check_id": "BC_AWS_NETWORKING_67", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port 80", "check_result": {"result": "PASSED", "evaluated_keys": []}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngress80", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-security-groups-do-not-allow-ingress-from-00000-to-port-80", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_79", "bc_check_id": "BC_AWS_GENERAL_31", "check_name": "Ensure Instance Metadata Service Version 1 is not enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["metadata_options/[0]/http_tokens"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IMDSv1Disabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-general-31", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_46", "bc_check_id": "BC_AWS_SECRETS_1", "check_name": "Ensure no hard-coded secrets exist in EC2 user data", "check_result": {"result": "PASSED", "evaluated_keys": ["user_data"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2Credentials", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/secrets-policies/bc-aws-secrets-1", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_126", "bc_check_id": "BC_AWS_LOGGING_26", "check_name": "Ensure that detailed monitoring is enabled for EC2 instances", "check_result": {"result": "PASSED", "evaluated_keys": ["monitoring"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2DetailedMonitoringEnabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/ensure-that-detailed-monitoring-is-enabled-for-ec2-instances", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_88", "bc_check_id": "BC_AWS_PUBLIC_12", "check_name": "EC2 instance should not have public IP.", "check_result": {"result": "PASSED", "evaluated_keys": ["associate_public_ip_address"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2PublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/public-policies/public-12", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_135", "bc_check_id": "BC_AWS_GENERAL_68", "check_name": "Ensure that EC2 is EBS optimized", "check_result": {"result": "PASSED", "evaluated_keys": ["ebs_optimized"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2EBSOptimized", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-ec2-is-ebs-optimized", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_8", "bc_check_id": "BC_AWS_GENERAL_13", "check_name": "Ensure all data stored in the Launch configuration or instance Elastic Blocks Store is securely encrypted", "check_result": {"result": "PASSED", "evaluated_keys": ["root_block_device", "ebs_block_device"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LaunchConfigurationEBSEncryption", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/general-13", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_79", "bc_check_id": "BC_AWS_GENERAL_31", "check_name": "Ensure Instance Metadata Service Version 1 is not enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["metadata_options/[0]/http_tokens"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IMDSv1Disabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-general-31", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_46", "bc_check_id": "BC_AWS_SECRETS_1", "check_name": "Ensure no hard-coded secrets exist in EC2 user data", "check_result": {"result": "PASSED", "evaluated_keys": ["user_data"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2Credentials", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/secrets-policies/bc-aws-secrets-1", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_126", "bc_check_id": "BC_AWS_LOGGING_26", "check_name": "Ensure that detailed monitoring is enabled for EC2 instances", "check_result": {"result": "PASSED", "evaluated_keys": ["monitoring"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2DetailedMonitoringEnabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/ensure-that-detailed-monitoring-is-enabled-for-ec2-instances", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_88", "bc_check_id": "BC_AWS_PUBLIC_12", "check_name": "EC2 instance should not have public IP.", "check_result": {"result": "PASSED", "evaluated_keys": ["associate_public_ip_address"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2PublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/public-policies/public-12", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_135", "bc_check_id": "BC_AWS_GENERAL_68", "check_name": "Ensure that EC2 is EBS optimized", "check_result": {"result": "PASSED", "evaluated_keys": ["ebs_optimized"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2EBSOptimized", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-ec2-is-ebs-optimized", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_8", "bc_check_id": "BC_AWS_GENERAL_13", "check_name": "Ensure all data stored in the Launch configuration or instance Elastic Blocks Store is securely encrypted", "check_result": {"result": "PASSED", "evaluated_keys": ["root_block_device", "ebs_block_device"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LaunchConfigurationEBSEncryption", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/general-13", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_79", "bc_check_id": "BC_AWS_GENERAL_31", "check_name": "Ensure Instance Metadata Service Version 1 is not enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["metadata_options/[0]/http_tokens"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IMDSv1Disabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-general-31", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_46", "bc_check_id": "BC_AWS_SECRETS_1", "check_name": "Ensure no hard-coded secrets exist in EC2 user data", "check_result": {"result": "PASSED", "evaluated_keys": ["user_data"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2Credentials", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/secrets-policies/bc-aws-secrets-1", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_126", "bc_check_id": "BC_AWS_LOGGING_26", "check_name": "Ensure that detailed monitoring is enabled for EC2 instances", "check_result": {"result": "PASSED", "evaluated_keys": ["monitoring"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2DetailedMonitoringEnabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/ensure-that-detailed-monitoring-is-enabled-for-ec2-instances", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_88", "bc_check_id": "BC_AWS_PUBLIC_12", "check_name": "EC2 instance should not have public IP.", "check_result": {"result": "PASSED", "evaluated_keys": ["associate_public_ip_address"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2PublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/public-policies/public-12", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_135", "bc_check_id": "BC_AWS_GENERAL_68", "check_name": "Ensure that EC2 is EBS optimized", "check_result": {"result": "PASSED", "evaluated_keys": ["ebs_optimized"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2EBSOptimized", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-ec2-is-ebs-optimized", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_8", "bc_check_id": "BC_AWS_GENERAL_13", "check_name": "Ensure all data stored in the Launch configuration or instance Elastic Blocks Store is securely encrypted", "check_result": {"result": "PASSED", "evaluated_keys": ["root_block_device", "ebs_block_device"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LaunchConfigurationEBSEncryption", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/general-13", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_79", "bc_check_id": "BC_AWS_GENERAL_31", "check_name": "Ensure Instance Metadata Service Version 1 is not enabled", "check_result": {"result": "PASSED", "evaluated_keys": ["metadata_options/[0]/http_tokens"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IMDSv1Disabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-general-31", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_46", "bc_check_id": "BC_AWS_SECRETS_1", "check_name": "Ensure no hard-coded secrets exist in EC2 user data", "check_result": {"result": "PASSED", "evaluated_keys": ["user_data"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2Credentials", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/secrets-policies/bc-aws-secrets-1", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_126", "bc_check_id": "BC_AWS_LOGGING_26", "check_name": "Ensure that detailed monitoring is enabled for EC2 instances", "check_result": {"result": "PASSED", "evaluated_keys": ["monitoring"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2DetailedMonitoringEnabled", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/ensure-that-detailed-monitoring-is-enabled-for-ec2-instances", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_88", "bc_check_id": "BC_AWS_PUBLIC_12", "check_name": "EC2 instance should not have public IP.", "check_result": {"result": "PASSED", "evaluated_keys": ["associate_public_ip_address"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2PublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/public-policies/public-12", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_135", "bc_check_id": "BC_AWS_GENERAL_68", "check_name": "Ensure that EC2 is EBS optimized", "check_result": {"result": "PASSED", "evaluated_keys": ["ebs_optimized"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.EC2EBSOptimized", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-ec2-is-ebs-optimized", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_8", "bc_check_id": "BC_AWS_GENERAL_13", "check_name": "Ensure all data stored in the Launch configuration or instance Elastic Blocks Store is securely encrypted", "check_result": {"result": "PASSED", "evaluated_keys": ["root_block_device", "ebs_block_device"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LaunchConfigurationEBSEncryption", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/general-13", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV_AWS_130", "bc_check_id": "BC_AWS_NETWORKING_53", "check_name": "Ensure VPC subnets do not assign public IP by default", "check_result": {"result": "PASSED", "evaluated_keys": ["map_public_ip_on_launch"]}, "code_block": [[26, "resource \"aws_subnet\" \"public\" {\n"], [27, "  count = length(var.public_subnet_cidrs)\n"], [28, "\n"], [29, "  vpc_id                  = aws_vpc.main.id\n"], [30, "  cidr_block              = var.public_subnet_cidrs[count.index]\n"], [31, "  availability_zone       = var.azs[count.index]\n"], [32, "  map_public_ip_on_launch = false # S\u1eeda t\u1eeb true th\u00e0nh false\n"], [33, "\n"], [34, "  tags = {\n"], [35, "    Name        = \"${var.project}-${var.environment}-public-subnet-${count.index + 1}\"\n"], [36, "    Type        = \"Public\"\n"], [37, "    Project     = var.project\n"], [38, "    Environment = var.environment\n"], [39, "  }\n"], [40, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [26, 40], "resource": "module.vpc.aws_subnet.public[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SubnetPublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-public-subnet-${0 + 1}", "Project": "microservices", "Type": "Public"}, "caller_file_path": "/main.tf", "caller_file_line_range": [37, 46], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-vpc-subnets-do-not-assign-public-ip-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV_AWS_130", "bc_check_id": "BC_AWS_NETWORKING_53", "check_name": "Ensure VPC subnets do not assign public IP by default", "check_result": {"result": "PASSED", "evaluated_keys": ["map_public_ip_on_launch"]}, "code_block": [[43, "resource \"aws_subnet\" \"private\" {\n"], [44, "  count = length(var.private_subnet_cidrs)\n"], [45, "\n"], [46, "  vpc_id            = aws_vpc.main.id\n"], [47, "  cidr_block        = var.private_subnet_cidrs[count.index]\n"], [48, "  availability_zone = var.azs[count.index]\n"], [49, "\n"], [50, "  tags = {\n"], [51, "    Name        = \"${var.project}-${var.environment}-private-subnet-${count.index + 1}\"\n"], [52, "    Type        = \"Private\"\n"], [53, "    Project     = var.project\n"], [54, "    Environment = var.environment\n"], [55, "  }\n"], [56, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [43, 56], "resource": "module.vpc.aws_subnet.private[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SubnetPublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-private-subnet-${0 + 1}", "Project": "microservices", "Type": "Private"}, "caller_file_path": "/main.tf", "caller_file_line_range": [37, 46], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-vpc-subnets-do-not-assign-public-ip-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV_AWS_130", "bc_check_id": "BC_AWS_NETWORKING_53", "check_name": "Ensure VPC subnets do not assign public IP by default", "check_result": {"result": "PASSED", "evaluated_keys": ["map_public_ip_on_launch"]}, "code_block": [[26, "resource \"aws_subnet\" \"public\" {\n"], [27, "  count = length(var.public_subnet_cidrs)\n"], [28, "\n"], [29, "  vpc_id                  = aws_vpc.main.id\n"], [30, "  cidr_block              = var.public_subnet_cidrs[count.index]\n"], [31, "  availability_zone       = var.azs[count.index]\n"], [32, "  map_public_ip_on_launch = false # S\u1eeda t\u1eeb true th\u00e0nh false\n"], [33, "\n"], [34, "  tags = {\n"], [35, "    Name        = \"${var.project}-${var.environment}-public-subnet-${count.index + 1}\"\n"], [36, "    Type        = \"Public\"\n"], [37, "    Project     = var.project\n"], [38, "    Environment = var.environment\n"], [39, "  }\n"], [40, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [26, 40], "resource": "module.vpc.aws_subnet.public[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SubnetPublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-public-subnet-${1 + 1}", "Project": "microservices", "Type": "Public"}, "caller_file_path": "/main.tf", "caller_file_line_range": [37, 46], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-vpc-subnets-do-not-assign-public-ip-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV_AWS_130", "bc_check_id": "BC_AWS_NETWORKING_53", "check_name": "Ensure VPC subnets do not assign public IP by default", "check_result": {"result": "PASSED", "evaluated_keys": ["map_public_ip_on_launch"]}, "code_block": [[43, "resource \"aws_subnet\" \"private\" {\n"], [44, "  count = length(var.private_subnet_cidrs)\n"], [45, "\n"], [46, "  vpc_id            = aws_vpc.main.id\n"], [47, "  cidr_block        = var.private_subnet_cidrs[count.index]\n"], [48, "  availability_zone = var.azs[count.index]\n"], [49, "\n"], [50, "  tags = {\n"], [51, "    Name        = \"${var.project}-${var.environment}-private-subnet-${count.index + 1}\"\n"], [52, "    Type        = \"Private\"\n"], [53, "    Project     = var.project\n"], [54, "    Environment = var.environment\n"], [55, "  }\n"], [56, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [43, 56], "resource": "module.vpc.aws_subnet.private[1]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SubnetPublicIP", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-private-subnet-${1 + 1}", "Project": "microservices", "Type": "Private"}, "caller_file_path": "/main.tf", "caller_file_line_range": [37, 46], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-vpc-subnets-do-not-assign-public-ip-by-default", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_35", "bc_check_id": "BC_AWS_NETWORKING_77", "check_name": "AWS NAT Gateways should be utilized for the default route", "check_result": {"result": "PASSED", "entity": {"aws_route_table": {"public": {"__end_line__": 103, "__start_line__": 90, "route": [{"cidr_block": ["0.0.0.0/0"], "gateway_id": ["aws_internet_gateway.main.id"]}], "tags": [{"Environment": "dev", "Name": "microservices-dev-public-rt", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.vpc.aws_route_table.public", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["route/*/cidr_block", "route/*/instance_id", "instance_id", "destination_cidr_block"]}, "code_block": [[90, "resource \"aws_route_table\" \"public\" {\n"], [91, "  vpc_id = aws_vpc.main.id\n"], [92, "\n"], [93, "  route {\n"], [94, "    cidr_block = \"0.0.0.0/0\"\n"], [95, "    gateway_id = aws_internet_gateway.main.id\n"], [96, "  }\n"], [97, "\n"], [98, "  tags = {\n"], [99, "    Name        = \"${var.project}-${var.environment}-public-rt\"\n"], [100, "    Project     = var.project\n"], [101, "    Environment = var.environment\n"], [102, "  }\n"], [103, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [90, 103], "resource": "module.vpc.aws_route_table.public", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-public-rt", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-nat-gateways-are-utilized-for-the-default-route", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_35", "bc_check_id": "BC_AWS_NETWORKING_77", "check_name": "AWS NAT Gateways should be utilized for the default route", "check_result": {"result": "PASSED", "entity": {"aws_route_table": {"private[0]": {"__end_line__": 121, "__start_line__": 106, "route": [{"cidr_block": ["0.0.0.0/0"], "nat_gateway_id": ["aws_nat_gateway.main[0].id"]}], "tags": [{"Environment": "dev", "Name": "microservices-dev-private-rt-${0 + 1}", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.vpc.aws_route_table.private[0]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["route/*/cidr_block", "route/*/instance_id", "instance_id", "destination_cidr_block"]}, "code_block": [[106, "resource \"aws_route_table\" \"private\" {\n"], [107, "  count = length(var.private_subnet_cidrs)\n"], [108, "\n"], [109, "  vpc_id = aws_vpc.main.id\n"], [110, "\n"], [111, "  route {\n"], [112, "    cidr_block     = \"0.0.0.0/0\"\n"], [113, "    nat_gateway_id = aws_nat_gateway.main[count.index].id\n"], [114, "  }\n"], [115, "\n"], [116, "  tags = {\n"], [117, "    Name        = \"${var.project}-${var.environment}-private-rt-${count.index + 1}\"\n"], [118, "    Project     = var.project\n"], [119, "    Environment = var.environment\n"], [120, "  }\n"], [121, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [106, 121], "resource": "module.vpc.aws_route_table.private[0]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-private-rt-${0 + 1}", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-nat-gateways-are-utilized-for-the-default-route", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_35", "bc_check_id": "BC_AWS_NETWORKING_77", "check_name": "AWS NAT Gateways should be utilized for the default route", "check_result": {"result": "PASSED", "entity": {"aws_route_table": {"private[1]": {"__end_line__": 121, "__start_line__": 106, "route": [{"cidr_block": ["0.0.0.0/0"], "nat_gateway_id": ["aws_nat_gateway.main[1].id"]}], "tags": [{"Environment": "dev", "Name": "microservices-dev-private-rt-${1 + 1}", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.vpc.aws_route_table.private[1]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["route/*/cidr_block", "route/*/instance_id", "instance_id", "destination_cidr_block"]}, "code_block": [[106, "resource \"aws_route_table\" \"private\" {\n"], [107, "  count = length(var.private_subnet_cidrs)\n"], [108, "\n"], [109, "  vpc_id = aws_vpc.main.id\n"], [110, "\n"], [111, "  route {\n"], [112, "    cidr_block     = \"0.0.0.0/0\"\n"], [113, "    nat_gateway_id = aws_nat_gateway.main[count.index].id\n"], [114, "  }\n"], [115, "\n"], [116, "  tags = {\n"], [117, "    Name        = \"${var.project}-${var.environment}-private-rt-${count.index + 1}\"\n"], [118, "    Project     = var.project\n"], [119, "    Environment = var.environment\n"], [120, "  }\n"], [121, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [106, 121], "resource": "module.vpc.aws_route_table.private[1]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-private-rt-${1 + 1}", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-nat-gateways-are-utilized-for-the-default-route", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_44", "bc_check_id": "BC_AWS_NETWORKING_80", "check_name": "Ensure AWS route table with VPC peering does not contain routes overly permissive to all traffic", "check_result": {"result": "PASSED", "entity": {"aws_route_table": {"public": {"__end_line__": 103, "__start_line__": 90, "route": [{"cidr_block": ["0.0.0.0/0"], "gateway_id": ["aws_internet_gateway.main.id"]}], "tags": [{"Environment": "dev", "Name": "microservices-dev-public-rt", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.vpc.aws_route_table.public", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["destination_cidr_block", "route/*/cidr_block", "route/*/vpc_peering_connection_id", "destination_ipv6_cidr_block", "route/*/ipv6_cidr_block", "vpc_peering_connection_id"]}, "code_block": [[90, "resource \"aws_route_table\" \"public\" {\n"], [91, "  vpc_id = aws_vpc.main.id\n"], [92, "\n"], [93, "  route {\n"], [94, "    cidr_block = \"0.0.0.0/0\"\n"], [95, "    gateway_id = aws_internet_gateway.main.id\n"], [96, "  }\n"], [97, "\n"], [98, "  tags = {\n"], [99, "    Name        = \"${var.project}-${var.environment}-public-rt\"\n"], [100, "    Project     = var.project\n"], [101, "    Environment = var.environment\n"], [102, "  }\n"], [103, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [90, 103], "resource": "module.vpc.aws_route_table.public", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-public-rt", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-route-table-with-vpc-peering-does-not-contain-routes-overly-permissive-to-all-traffic", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_44", "bc_check_id": "BC_AWS_NETWORKING_80", "check_name": "Ensure AWS route table with VPC peering does not contain routes overly permissive to all traffic", "check_result": {"result": "PASSED", "entity": {"aws_route_table": {"private[0]": {"__end_line__": 121, "__start_line__": 106, "route": [{"cidr_block": ["0.0.0.0/0"], "nat_gateway_id": ["aws_nat_gateway.main[0].id"]}], "tags": [{"Environment": "dev", "Name": "microservices-dev-private-rt-${0 + 1}", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.vpc.aws_route_table.private[0]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["destination_cidr_block", "route/*/cidr_block", "route/*/vpc_peering_connection_id", "destination_ipv6_cidr_block", "route/*/ipv6_cidr_block", "vpc_peering_connection_id"]}, "code_block": [[106, "resource \"aws_route_table\" \"private\" {\n"], [107, "  count = length(var.private_subnet_cidrs)\n"], [108, "\n"], [109, "  vpc_id = aws_vpc.main.id\n"], [110, "\n"], [111, "  route {\n"], [112, "    cidr_block     = \"0.0.0.0/0\"\n"], [113, "    nat_gateway_id = aws_nat_gateway.main[count.index].id\n"], [114, "  }\n"], [115, "\n"], [116, "  tags = {\n"], [117, "    Name        = \"${var.project}-${var.environment}-private-rt-${count.index + 1}\"\n"], [118, "    Project     = var.project\n"], [119, "    Environment = var.environment\n"], [120, "  }\n"], [121, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [106, 121], "resource": "module.vpc.aws_route_table.private[0]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-private-rt-${0 + 1}", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-route-table-with-vpc-peering-does-not-contain-routes-overly-permissive-to-all-traffic", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_44", "bc_check_id": "BC_AWS_NETWORKING_80", "check_name": "Ensure AWS route table with VPC peering does not contain routes overly permissive to all traffic", "check_result": {"result": "PASSED", "entity": {"aws_route_table": {"private[1]": {"__end_line__": 121, "__start_line__": 106, "route": [{"cidr_block": ["0.0.0.0/0"], "nat_gateway_id": ["aws_nat_gateway.main[1].id"]}], "tags": [{"Environment": "dev", "Name": "microservices-dev-private-rt-${1 + 1}", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.vpc.aws_route_table.private[1]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["destination_cidr_block", "route/*/cidr_block", "route/*/vpc_peering_connection_id", "destination_ipv6_cidr_block", "route/*/ipv6_cidr_block", "vpc_peering_connection_id"]}, "code_block": [[106, "resource \"aws_route_table\" \"private\" {\n"], [107, "  count = length(var.private_subnet_cidrs)\n"], [108, "\n"], [109, "  vpc_id = aws_vpc.main.id\n"], [110, "\n"], [111, "  route {\n"], [112, "    cidr_block     = \"0.0.0.0/0\"\n"], [113, "    nat_gateway_id = aws_nat_gateway.main[count.index].id\n"], [114, "  }\n"], [115, "\n"], [116, "  tags = {\n"], [117, "    Name        = \"${var.project}-${var.environment}-private-rt-${count.index + 1}\"\n"], [118, "    Project     = var.project\n"], [119, "    Environment = var.environment\n"], [120, "  }\n"], [121, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [106, 121], "resource": "module.vpc.aws_route_table.private[1]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-private-rt-${1 + 1}", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-route-table-with-vpc-peering-does-not-contain-routes-overly-permissive-to-all-traffic", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_5", "bc_check_id": "BC_AWS_NETWORKING_51", "check_name": "Ensure that Security Groups are attached to another resource", "check_result": {"result": "PASSED", "entity": {"aws_security_group": {"web": {"__end_line__": 71, "__start_line__": 2, "description": ["Security group for web servers"], "dynamic": [{"ingress": {"content": [{"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}], "for_each": []}}], "egress": [{"cidr_blocks": [["0.0.0.0/0"]], "description": ["HTTP outbound"], "from_port": [80], "protocol": ["tcp"], "to_port": [80]}, {"cidr_blocks": [["0.0.0.0/0"]], "description": ["HTTPS outbound"], "from_port": [443], "protocol": ["tcp"], "to_port": [443]}, {"cidr_blocks": [["0.0.0.0/0"]], "description": ["DNS outbound"], "from_port": [53], "protocol": ["udp"], "to_port": [53]}], "ingress": [{"cidr_blocks": [["0.0.0.0/0"]], "description": ["HTTP"], "from_port": [80], "protocol": ["tcp"], "to_port": [80]}, {"cidr_blocks": [["0.0.0.0/0"]], "description": ["HTTPS"], "from_port": [443], "protocol": ["tcp"], "to_port": [443]}, {"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}, {"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}, {"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}, {"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}, {"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}, {"cidr_blocks": [["10.0.0.0/16"]], "description": ["SSH from trusted IPs"], "from_port": [22], "protocol": ["tcp"], "to_port": [22]}], "lifecycle": [{"create_before_destroy": [true]}], "name_prefix": ["microservices-dev-web-"], "tags": [{"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.ec2.aws_security_group.web", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["resource_type", "networking"]}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-that-security-groups-are-attached-to-ec2-instances-or-elastic-network-interfaces-enis", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_5", "bc_check_id": "BC_AWS_NETWORKING_51", "check_name": "Ensure that Security Groups are attached to another resource", "check_result": {"result": "PASSED", "entity": {"aws_security_group": {"app": {"__end_line__": 134, "__start_line__": 74, "description": ["Security group for application servers"], "dynamic": [{"ingress": {"content": [{"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}], "for_each": []}}], "egress": [{"cidr_blocks": [["0.0.0.0/0"]], "description": ["HTTP outbound"], "from_port": [80], "protocol": ["tcp"], "to_port": [80]}, {"cidr_blocks": [["0.0.0.0/0"]], "description": ["HTTPS outbound"], "from_port": [443], "protocol": ["tcp"], "to_port": [443]}, {"cidr_blocks": [["0.0.0.0/0"]], "description": ["DNS outbound"], "from_port": [53], "protocol": ["udp"], "to_port": [53]}], "ingress": [{"description": ["App port from web servers"], "from_port": [8080], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [8080]}, {"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}, {"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}, {"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}, {"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}, {"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}, {"description": ["SSH from web servers"], "from_port": [22], "protocol": ["tcp"], "security_groups": [["aws_security_group.web.id"]], "to_port": [22]}], "lifecycle": [{"create_before_destroy": [true]}], "name_prefix": ["microservices-dev-app-"], "tags": [{"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}], "vpc_id": ["aws_vpc.main.id"], "__address__": "module.ec2.aws_security_group.app", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["resource_type", "networking"]}, "code_block": [[74, "resource \"aws_security_group\" \"app\" {\n"], [75, "  name_prefix = \"${var.project}-${var.environment}-app-\"\n"], [76, "  description = \"Security group for application servers\" # Th\u00eam description\n"], [77, "  vpc_id      = var.vpc_id\n"], [78, "\n"], [79, "  # Application port (8080)\n"], [80, "  ingress {\n"], [81, "    description     = \"App port from web servers\"\n"], [82, "    from_port       = 8080\n"], [83, "    to_port         = 8080\n"], [84, "    protocol        = \"tcp\"\n"], [85, "    security_groups = [aws_security_group.web.id]\n"], [86, "  }\n"], [87, "\n"], [88, "  # SSH (only if key_name is provided)\n"], [89, "  dynamic \"ingress\" {\n"], [90, "    for_each = var.key_name != \"\" ? [1] : []\n"], [91, "    content {\n"], [92, "      description     = \"SSH from web servers\"\n"], [93, "      from_port       = 22\n"], [94, "      to_port         = 22\n"], [95, "      protocol        = \"tcp\"\n"], [96, "      security_groups = [aws_security_group.web.id]\n"], [97, "    }\n"], [98, "  }\n"], [99, "\n"], [100, "  # H\u1ea1n ch\u1ebf egress\n"], [101, "  egress {\n"], [102, "    description = \"HTTP outbound\"\n"], [103, "    from_port   = 80\n"], [104, "    to_port     = 80\n"], [105, "    protocol    = \"tcp\"\n"], [106, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [107, "  }\n"], [108, "\n"], [109, "  egress {\n"], [110, "    description = \"HTTPS outbound\"\n"], [111, "    from_port   = 443\n"], [112, "    to_port     = 443\n"], [113, "    protocol    = \"tcp\"\n"], [114, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [115, "  }\n"], [116, "\n"], [117, "  egress {\n"], [118, "    description = \"DNS outbound\"\n"], [119, "    from_port   = 53\n"], [120, "    to_port     = 53\n"], [121, "    protocol    = \"udp\"\n"], [122, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [123, "  }\n"], [124, "\n"], [125, "  tags = {\n"], [126, "    Name        = \"${var.project}-${var.environment}-app-sg\"\n"], [127, "    Project     = var.project\n"], [128, "    Environment = var.environment\n"], [129, "  }\n"], [130, "\n"], [131, "  lifecycle {\n"], [132, "    create_before_destroy = true\n"], [133, "  }\n"], [134, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [74, 134], "resource": "module.ec2.aws_security_group.app", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-sg", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-that-security-groups-are-attached-to-ec2-instances-or-elastic-network-interfaces-enis", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_19", "bc_check_id": "BC_AWS_NETWORKING_48", "check_name": "Ensure that all EIP addresses allocated to a VPC are attached to EC2 instances", "check_result": {"result": "PASSED", "entity": {"aws_eip": {"nat[0]": {"__end_line__": 71, "__start_line__": 59, "depends_on": [["aws_internet_gateway.main"]], "domain": ["vpc"], "tags": [{"Environment": "dev", "Name": "microservices-dev-nat-eip-${0 + 1}", "Project": "microservices"}], "__address__": "module.vpc.aws_eip.nat[0]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["domain", "resource_type", "instance_id", "instance", "vpc"]}, "code_block": [[59, "resource \"aws_eip\" \"nat\" {\n"], [60, "  count = length(var.public_subnet_cidrs)\n"], [61, "\n"], [62, "  domain = \"vpc\"\n"], [63, "\n"], [64, "  tags = {\n"], [65, "    Name        = \"${var.project}-${var.environment}-nat-eip-${count.index + 1}\"\n"], [66, "    Project     = var.project\n"], [67, "    Environment = var.environment\n"], [68, "  }\n"], [69, "\n"], [70, "  depends_on = [aws_internet_gateway.main]\n"], [71, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [59, 71], "resource": "module.vpc.aws_eip.nat[0]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-nat-eip-${0 + 1}", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-that-all-eip-addresses-allocated-to-a-vpc-are-attached-to-ec2-instances", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_19", "bc_check_id": "BC_AWS_NETWORKING_48", "check_name": "Ensure that all EIP addresses allocated to a VPC are attached to EC2 instances", "check_result": {"result": "PASSED", "entity": {"aws_eip": {"nat[1]": {"__end_line__": 71, "__start_line__": 59, "depends_on": [["aws_internet_gateway.main"]], "domain": ["vpc"], "tags": [{"Environment": "dev", "Name": "microservices-dev-nat-eip-${1 + 1}", "Project": "microservices"}], "__address__": "module.vpc.aws_eip.nat[1]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["domain", "resource_type", "instance_id", "instance", "vpc"]}, "code_block": [[59, "resource \"aws_eip\" \"nat\" {\n"], [60, "  count = length(var.public_subnet_cidrs)\n"], [61, "\n"], [62, "  domain = \"vpc\"\n"], [63, "\n"], [64, "  tags = {\n"], [65, "    Name        = \"${var.project}-${var.environment}-nat-eip-${count.index + 1}\"\n"], [66, "    Project     = var.project\n"], [67, "    Environment = var.environment\n"], [68, "  }\n"], [69, "\n"], [70, "  depends_on = [aws_internet_gateway.main]\n"], [71, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [59, 71], "resource": "module.vpc.aws_eip.nat[1]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-nat-eip-${1 + 1}", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-that-all-eip-addresses-allocated-to-a-vpc-are-attached-to-ec2-instances", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_12", "bc_check_id": "BC_AWS_NETWORKING_4", "check_name": "Ensure the default security group of every VPC restricts all traffic", "check_result": {"result": "PASSED", "entity": {"aws_vpc": {"main": {"__end_line__": 12, "__start_line__": 2, "cidr_block": ["10.0.0.0/16"], "enable_dns_hostnames": [true], "enable_dns_support": [true], "tags": [{"Environment": "dev", "Name": "microservices-dev-vpc", "Project": "microservices"}], "__address__": "module.vpc.aws_vpc.main", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["ingress/to_port", "ingress/from_port", "egress/cidr_blocks", "ingress/protocol", "ingress/self", "egress/to_port", "resource_type", "egress/protocol", "egress/from_port"]}, "code_block": [[2, "resource \"aws_vpc\" \"main\" {\n"], [3, "  cidr_block           = var.vpc_cidr\n"], [4, "  enable_dns_hostnames = true\n"], [5, "  enable_dns_support   = true\n"], [6, "\n"], [7, "  tags = {\n"], [8, "    Name        = \"${var.project}-${var.environment}-vpc\"\n"], [9, "    Project     = var.project\n"], [10, "    Environment = var.environment\n"], [11, "  }\n"], [12, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [2, 12], "resource": "module.vpc.aws_vpc.main", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-vpc", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/networking-4", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "cidr_block": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_cidr", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}, {"type": "resource", "name": "aws_vpc.main", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "module_connection": false}, {"type": "output", "name": "vpc_cidr_block", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/outputs.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}], "failed_checks": [{"check_id": "CKV_AWS_260", "bc_check_id": "BC_AWS_NETWORKING_67", "check_name": "Ensure no security groups allow ingress from 0.0.0.0:0 to port 80", "check_result": {"result": "FAILED", "evaluated_keys": ["ingress/[0]/from_port", "ingress/[0]/to_port", "ingress/[0]/cidr_blocks", "ingress/[0]/ipv6_cidr_blocks"]}, "code_block": [[2, "resource \"aws_security_group\" \"web\" {\n"], [3, "  name_prefix = \"${var.project}-${var.environment}-web-\"\n"], [4, "  description = \"Security group for web servers\" # Th\u00eam description\n"], [5, "  vpc_id      = var.vpc_id\n"], [6, "\n"], [7, "  # HTTP\n"], [8, "  ingress {\n"], [9, "    description = \"HTTP\"\n"], [10, "    from_port   = 80\n"], [11, "    to_port     = 80\n"], [12, "    protocol    = \"tcp\"\n"], [13, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [14, "  }\n"], [15, "\n"], [16, "  # HTTPS\n"], [17, "  ingress {\n"], [18, "    description = \"HTTPS\"\n"], [19, "    from_port   = 443\n"], [20, "    to_port     = 443\n"], [21, "    protocol    = \"tcp\"\n"], [22, "    cidr_blocks = [\"0.0.0.0/0\"] # C\u00f3 th\u1ec3 gi\u1eef nguy\u00ean cho web public\n"], [23, "  }\n"], [24, "\n"], [25, "  # SSH - H\u1ea1n ch\u1ebf IP thay v\u00ec 0.0.0.0/0\n"], [26, "  dynamic \"ingress\" {\n"], [27, "    for_each = var.key_name != \"\" ? [1] : []\n"], [28, "    content {\n"], [29, "      description = \"SSH from trusted IPs\"\n"], [30, "      from_port   = 22\n"], [31, "      to_port     = 22\n"], [32, "      protocol    = \"tcp\"\n"], [33, "      cidr_blocks = [\"10.0.0.0/16\"] # Ch\u1ec9 cho ph\u00e9p t\u1eeb VPC\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # H\u1ea1n ch\u1ebf egress thay v\u00ec m\u1edf to\u00e0n b\u1ed9\n"], [38, "  egress {\n"], [39, "    description = \"HTTP outbound\"\n"], [40, "    from_port   = 80\n"], [41, "    to_port     = 80\n"], [42, "    protocol    = \"tcp\"\n"], [43, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [44, "  }\n"], [45, "\n"], [46, "  egress {\n"], [47, "    description = \"HTTPS outbound\"\n"], [48, "    from_port   = 443\n"], [49, "    to_port     = 443\n"], [50, "    protocol    = \"tcp\"\n"], [51, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [52, "  }\n"], [53, "\n"], [54, "  egress {\n"], [55, "    description = \"DNS outbound\"\n"], [56, "    from_port   = 53\n"], [57, "    to_port     = 53\n"], [58, "    protocol    = \"udp\"\n"], [59, "    cidr_blocks = [\"0.0.0.0/0\"]\n"], [60, "  }\n"], [61, "\n"], [62, "  tags = {\n"], [63, "    Name        = \"${var.project}-${var.environment}-web-sg\"\n"], [64, "    Project     = var.project\n"], [65, "    Environment = var.environment\n"], [66, "  }\n"], [67, "\n"], [68, "  lifecycle {\n"], [69, "    create_before_destroy = true\n"], [70, "  }\n"], [71, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [2, 71], "resource": "module.ec2.aws_security_group.web", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.SecurityGroupUnrestrictedIngress80", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-sg", "Project": "microservices"}, "caller_file_path": "/main.tf", "caller_file_line_range": [49, 61], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-aws-security-groups-do-not-allow-ingress-from-00000-to-port-80", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "name_prefix": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "vpc_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress.for_each": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "dynamic.ingress": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_11", "bc_check_id": "BC_AWS_LOGGING_9", "check_name": "Ensure VPC flow logging is enabled in all VPCs", "check_result": {"result": "FAILED", "entity": {"aws_vpc": {"main": {"__end_line__": 12, "__start_line__": 2, "cidr_block": ["10.0.0.0/16"], "enable_dns_hostnames": [true], "enable_dns_support": [true], "tags": [{"Environment": "dev", "Name": "microservices-dev-vpc", "Project": "microservices"}], "__address__": "module.vpc.aws_vpc.main", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["networking", "resource_type"]}, "code_block": [[2, "resource \"aws_vpc\" \"main\" {\n"], [3, "  cidr_block           = var.vpc_cidr\n"], [4, "  enable_dns_hostnames = true\n"], [5, "  enable_dns_support   = true\n"], [6, "\n"], [7, "  tags = {\n"], [8, "    Name        = \"${var.project}-${var.environment}-vpc\"\n"], [9, "    Project     = var.project\n"], [10, "    Environment = var.environment\n"], [11, "  }\n"], [12, "}\n"]], "file_path": "/modules/vpc/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "repo_file_path": "/modules/vpc/main.tf", "file_line_range": [2, 12], "resource": "module.vpc.aws_vpc.main", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-vpc", "Project": "microservices"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/logging-9-enable-vpc-flow-logging", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "cidr_block": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "vpc_cidr", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}, {"type": "resource", "name": "aws_vpc.main", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/main.tf", "module_connection": false}, {"type": "output", "name": "vpc_cidr_block", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/outputs.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/vpc/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "vpc", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 12, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_41", "bc_check_id": "BC_AWS_IAM_69", "check_name": "Ensure an IAM role is attached to EC2 instance", "check_result": {"result": "FAILED", "entity": {"aws_instance": {"web[0]": {"__end_line__": 184, "__start_line__": 137, "ami": ["ami-0c02fb55956c7d316"], "ebs_optimized": [true], "instance_type": ["t3.micro"], "key_name": ["None"], "lifecycle": [{"create_before_destroy": [true]}], "metadata_options": [{"http_endpoint": ["enabled"], "http_put_response_hop_limit": [1], "http_tokens": ["required"]}], "monitoring": [true], "root_block_device": [{"delete_on_termination": [true], "encrypted": [true], "tags": [{"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}-root", "Project": "microservices"}], "volume_size": [20], "volume_type": ["gp3"]}], "subnet_id": ["${${aws_subnet.public[*].id}[0 % length(${aws_subnet.public[*].id})]}"], "tags": [{"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}], "user_data": ["${base64encode(templatefile(\"${path.module}/user_data_web.sh\",{'instance_name': 'microservices-dev-web-${0 + 1}'}))}"], "vpc_security_group_ids": [["aws_security_group.web.id"]], "__address__": "module.ec2.aws_instance.web[0]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["iam_instance_profile"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[0]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${0 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/ensure-an-iam-role-is-attached-to-ec2-instance", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_41", "bc_check_id": "BC_AWS_IAM_69", "check_name": "Ensure an IAM role is attached to EC2 instance", "check_result": {"result": "FAILED", "entity": {"aws_instance": {"app[0]": {"__end_line__": 234, "__start_line__": 187, "ami": ["ami-0c02fb55956c7d316"], "ebs_optimized": [true], "instance_type": ["t3.micro"], "key_name": ["None"], "lifecycle": [{"create_before_destroy": [true]}], "metadata_options": [{"http_endpoint": ["enabled"], "http_put_response_hop_limit": [1], "http_tokens": ["required"]}], "monitoring": [true], "root_block_device": [{"delete_on_termination": [true], "encrypted": [true], "tags": [{"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}-root", "Project": "microservices"}], "volume_size": [20], "volume_type": ["gp3"]}], "subnet_id": ["${${aws_subnet.private[*].id}[0 % length(${aws_subnet.private[*].id})]}"], "tags": [{"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}], "user_data": ["${base64encode(templatefile(\"${path.module}/user_data_app.sh\",{'instance_name': 'microservices-dev-app-${0 + 1}'}))}"], "vpc_security_group_ids": [["aws_security_group.app.id"]], "__address__": "module.ec2.aws_instance.app[0]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["iam_instance_profile"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[0]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${0 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/ensure-an-iam-role-is-attached-to-ec2-instance", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_41", "bc_check_id": "BC_AWS_IAM_69", "check_name": "Ensure an IAM role is attached to EC2 instance", "check_result": {"result": "FAILED", "entity": {"aws_instance": {"web[1]": {"__end_line__": 184, "__start_line__": 137, "ami": ["ami-0c02fb55956c7d316"], "ebs_optimized": [true], "instance_type": ["t3.micro"], "key_name": ["None"], "lifecycle": [{"create_before_destroy": [true]}], "metadata_options": [{"http_endpoint": ["enabled"], "http_put_response_hop_limit": [1], "http_tokens": ["required"]}], "monitoring": [true], "root_block_device": [{"delete_on_termination": [true], "encrypted": [true], "tags": [{"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}-root", "Project": "microservices"}], "volume_size": [20], "volume_type": ["gp3"]}], "subnet_id": ["${${aws_subnet.public[*].id}[1 % length(${aws_subnet.public[*].id})]}"], "tags": [{"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}], "user_data": ["${base64encode(templatefile(\"${path.module}/user_data_web.sh\",{'instance_name': 'microservices-dev-web-${1 + 1}'}))}"], "vpc_security_group_ids": [["aws_security_group.web.id"]], "__address__": "module.ec2.aws_instance.web[1]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["iam_instance_profile"]}, "code_block": [[137, "resource \"aws_instance\" \"web\" {\n"], [138, "  count = var.ec2_instance_count\n"], [139, "\n"], [140, "  ami                    = var.ami_id\n"], [141, "  instance_type          = var.instance_type\n"], [142, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [143, "  vpc_security_group_ids = [aws_security_group.web.id]\n"], [144, "  subnet_id              = var.public_subnet_ids[count.index % length(var.public_subnet_ids)]\n"], [145, "\n"], [146, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [147, "  monitoring    = true # Enable detailed monitoring\n"], [148, "  ebs_optimized = true # Enable EBS optimization\n"], [149, "\n"], [150, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [151, "  metadata_options {\n"], [152, "    http_endpoint               = \"enabled\"\n"], [153, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [154, "    http_put_response_hop_limit = 1\n"], [155, "  }\n"], [156, "\n"], [157, "  user_data = base64encode(templatefile(\"${path.module}/user_data_web.sh\", {\n"], [158, "    instance_name = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [159, "  }))\n"], [160, "\n"], [161, "  root_block_device {\n"], [162, "    volume_type           = \"gp3\"\n"], [163, "    volume_size           = 20\n"], [164, "    delete_on_termination = true\n"], [165, "    encrypted             = true\n"], [166, "\n"], [167, "    tags = {\n"], [168, "      Name        = \"${var.project}-${var.environment}-web-${count.index + 1}-root\"\n"], [169, "      Project     = var.project\n"], [170, "      Environment = var.environment\n"], [171, "    }\n"], [172, "  }\n"], [173, "\n"], [174, "  tags = {\n"], [175, "    Name        = \"${var.project}-${var.environment}-web-${count.index + 1}\"\n"], [176, "    Type        = \"WebServer\"\n"], [177, "    Project     = var.project\n"], [178, "    Environment = var.environment\n"], [179, "  }\n"], [180, "\n"], [181, "  lifecycle {\n"], [182, "    create_before_destroy = true\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [137, 184], "resource": "module.ec2.aws_instance.web[1]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-web-${1 + 1}", "Project": "microservices", "Type": "WebServer"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/ensure-an-iam-role-is-attached-to-ec2-instance", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "public_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}, {"check_id": "CKV2_AWS_41", "bc_check_id": "BC_AWS_IAM_69", "check_name": "Ensure an IAM role is attached to EC2 instance", "check_result": {"result": "FAILED", "entity": {"aws_instance": {"app[1]": {"__end_line__": 234, "__start_line__": 187, "ami": ["ami-0c02fb55956c7d316"], "ebs_optimized": [true], "instance_type": ["t3.micro"], "key_name": ["None"], "lifecycle": [{"create_before_destroy": [true]}], "metadata_options": [{"http_endpoint": ["enabled"], "http_put_response_hop_limit": [1], "http_tokens": ["required"]}], "monitoring": [true], "root_block_device": [{"delete_on_termination": [true], "encrypted": [true], "tags": [{"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}-root", "Project": "microservices"}], "volume_size": [20], "volume_type": ["gp3"]}], "subnet_id": ["${${aws_subnet.private[*].id}[1 % length(${aws_subnet.private[*].id})]}"], "tags": [{"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}], "user_data": ["${base64encode(templatefile(\"${path.module}/user_data_app.sh\",{'instance_name': 'microservices-dev-app-${1 + 1}'}))}"], "vpc_security_group_ids": [["aws_security_group.app.id"]], "__address__": "module.ec2.aws_instance.app[1]", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["iam_instance_profile"]}, "code_block": [[187, "resource \"aws_instance\" \"app\" {\n"], [188, "  count = var.ec2_instance_count\n"], [189, "\n"], [190, "  ami                    = var.ami_id\n"], [191, "  instance_type          = var.instance_type\n"], [192, "  key_name               = var.key_name != \"\" ? var.key_name : null\n"], [193, "  vpc_security_group_ids = [aws_security_group.app.id]\n"], [194, "  subnet_id              = var.private_subnet_ids[count.index % length(var.private_subnet_ids)]\n"], [195, "\n"], [196, "  # Th\u00eam c\u00e1c c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt\n"], [197, "  monitoring    = true # Enable detailed monitoring\n"], [198, "  ebs_optimized = true # Enable EBS optimization\n"], [199, "\n"], [200, "  # C\u1ea5u h\u00ecnh IMDS v2\n"], [201, "  metadata_options {\n"], [202, "    http_endpoint               = \"enabled\"\n"], [203, "    http_tokens                 = \"required\" # Force IMDSv2\n"], [204, "    http_put_response_hop_limit = 1\n"], [205, "  }\n"], [206, "\n"], [207, "  user_data = base64encode(templatefile(\"${path.module}/user_data_app.sh\", {\n"], [208, "    instance_name = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [209, "  }))\n"], [210, "\n"], [211, "  root_block_device {\n"], [212, "    volume_type           = \"gp3\"\n"], [213, "    volume_size           = 20\n"], [214, "    delete_on_termination = true\n"], [215, "    encrypted             = true\n"], [216, "\n"], [217, "    tags = {\n"], [218, "      Name        = \"${var.project}-${var.environment}-app-${count.index + 1}-root\"\n"], [219, "      Project     = var.project\n"], [220, "      Environment = var.environment\n"], [221, "    }\n"], [222, "  }\n"], [223, "\n"], [224, "  tags = {\n"], [225, "    Name        = \"${var.project}-${var.environment}-app-${count.index + 1}\"\n"], [226, "    Type        = \"AppServer\"\n"], [227, "    Project     = var.project\n"], [228, "    Environment = var.environment\n"], [229, "  }\n"], [230, "\n"], [231, "  lifecycle {\n"], [232, "    create_before_destroy = true\n"], [233, "  }\n"], [234, "}"]], "file_path": "/modules/ec2/main.tf", "file_abs_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "repo_file_path": "/modules/ec2/main.tf", "file_line_range": [187, 234], "resource": "module.ec2.aws_instance.app[1]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"Environment": "dev", "Name": "microservices-dev-app-${1 + 1}", "Project": "microservices", "Type": "AppServer"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/ensure-an-iam-role-is-attached-to-ec2-instance", "details": [], "check_len": null, "definition_context_file_path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/main.tf", "breadcrumbs": {"root_block_device.tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "key_name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "key_name", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "instance_type": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "instance_type", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "root_block_device.tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Name": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "user_data": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Environment": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "environment", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "subnet_id": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "private_subnet_ids", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "tags.Project": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "project", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "ami": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "module_connection": false}, {"type": "variable", "name": "ami_id", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/modules/ec2/variables.tf", "module_connection": false}], "source_module_": [{"type": "module", "name": "ec2", "path": "/home/cloudshell-user/projects/aws-infra-microservices/terraform/main.tf", "idx": 13, "source_module_object": null}]}}], "skipped_checks": [], "parsing_errors": []}, "summary": {"passed": 51, "failed": 6, "skipped": 0, "parsing_errors": 0, "resource_count": 24, "checkov_version": "3.2.441"}, "url": "Add an api key '--bc-api-key <api-key>' to see more detailed insights via https://bridgecrew.cloud"}